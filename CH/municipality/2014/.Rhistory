fileUrl <- "http://www.bfs.admin.ch/bfs/portal/de/index/themen/17/03/blank/key/2014/013.Document.176630.xls"
download.file(fileUrl, destfile = "ext.xls", method = "curl")
getwd()
setwd("/Users/rogerfischer/datamap/geoid/CH/municipality/2014")
getwd()
fileUrl <- "http://www.bfs.admin.ch/bfs/portal/de/index/themen/17/03/blank/key/2014/013.Document.176630.xls"
download.file(fileUrl, destfile = "ext.xls", method = "curl")
dateDownloaded <- date()
dateDownloaded
require(gdata)
ext <- read.xls ("ext.xls", sheet = 1, header = TRUE, stringsAsFactors=FALSE)
head(ext)
head(ext, 10)
ext_csv <- ext[-c(1:4), ]
head(ext_csv)
ext_csv1 <- ext[-c(1:5), ]
head(ext_csv1)
ext_csv1[, 1:2] <- NULL
ext_csv2 <- ext_csv1[, -c(1:2)]
head(ext_csv2)
tail(ext_csv2)
tail(ext_csv2, 10)
ext_csv3 <- ext_csv2[, -c(2373:2377)]
dim(ext_csv3)
tail(ext_csv3)
ext_csv3 <- ext_csv2[, -c(2373:2377)]
dim(ext_csv3)
tail(ext_csv3)
head(ext_csv3)
tail(ext_csv3)
dim(ext_csv3)
View(ext_csv3)
head(ext_csv3)
ext_csv4 <- ext_csv3[-c(10:13), ]
dim(ext_csv4)
head(ext_csv4)
tail(ext_csv4)
write.table(ext_csv4, file="ext_initiative_20140902.csv", sep="," , col.names=TRUE, row.names=FALSE)
ext_csv4 <- ext_csv3[, -c(10:13) ]
write.table(ext_csv4, file="ext_initiative_20140902.csv", sep="," , col.names=TRUE, row.names=FALSE)
ext_csv1 <- ext[-c(1:5), ]
## remove first two colums
ext_csv2 <- ext_csv1[, -c(1:2)]
ext_csv3 <- ext_csv2[-c(2373:2377), ]
ext_csv4 <- ext_csv3[, -c(10:13) ]
write.table(ext_csv4, file="ext_initiative_20140902.csv", sep="," , col.names=TRUE, row.names=FALSE)
write.table(ext_csv4, file="ext_initiative_20140902.csv", sep="," , col.names=TRUE, row.names=FALSE)
tail(ext_csv4)
View(ext_csv4)
View(ext_csv4)
ext_csv3 <- ext_csv2[-c(2355:2377), ]
ext_csv4 <- ext_csv3[, -c(10:13) ]
write.table(ext_csv4, file="ext_initiative_20140902.csv", sep="," , col.names=TRUE, row.names=FALSE)
ext_csv3 <- ext_csv2[-c(2354:2377), ]
ext_csv4 <- ext_csv3[, -c(10:13) ]
ext_csv5 <- ext_csv1[c(2372:2381), ]
ext_csv5
tail(ext_csv1, 30)
ext_csv5 <- ext_csv1[c(2362:2372), ]
ext_csv5
ext_csv5
tail(ext_csv1, 30)
ext_csv5 <- ext_csv1[c(2362:2372), ]
ext_csv5
ext_csv5 <- ext_csv1[c(2357:2367), ]
ext_csv5
dim(ext_csv5)
ext_csv5 <- ext_csv1[c(2357:2367), ]
dim(ext_csv5)
ext_csv5 <- ext_csv1[c(2357:2367), (1:5)]
dim(ext_csv5)
ext_csv5
ext_csv5 <- ext_csv1[c(2358:2367), (3:7)]
ext_csv5
ext_csv5 <- ext_csv1[c(2358:2367), (1:7)]
ext_csv5
ext_csv5$X.1 <- NULL
ext_csv5$X.2 <- NULL
dim(ext_csv5)
ext_csv5
names(ext_cv5) <- c("gdenr_without_polling_station", "gdename_without_polling_station", "gdenr", "gdename", "gdekt" )
class(ext_csv5)
names(ext_cv5) <- c("gdenr_without_polling_station", "gdename_without_polling_station", "gdenr", "gdename", "gdekt" )
ext_cv5
names(ext_csv5) <- c("gdenr_without_polling_station", "gdename_without_polling_station", "gdenr", "gdename", "gdekt")
ext_csv5
write.table(ext, file="extraw_initiative_20140902.csv", sep="," , col.names=TRUE, row.names=FALSE)
head(ext_csv4)
names(ext_csv4) <- c("gdenr", "gdename", "entitled_to_vote", "votes_cast", "turnout", "valid_votes", "yes", "no", "yes_percentage")
head(ext_csv4)
write.table(ext_csv4, file="ext1_initiative_20140902.csv", sep="," , col.names=TRUE, row.names=FALSE)
write.table(ext_csv5, file="ext2_initiative_20140902.csv", sep="," , col.names=TRUE, row.names=FALSE)
ext_csv6 <- ext_csv5
ext_csv6$gdenr <- NULL
ext_csv6$gdename <- NULL
ext_csv6$gdenr <- ext_csv6$gdenr_without_polling_station
ext_csv6
names(ext_csv5) <- c("gdenr_without_polling_station", "gdename_without_polling_station", "gdenr_polling_station", "gdename_polling_station", "gdekt")
write.table(ext_csv5, file="ext2_initiative_20140902.csv", sep="," , col.names=TRUE, row.names=FALSE)
ext_csv6 <- ext_csv5
ext_csv6$gdenr <- ext_csv6$gdenr_without_polling_station
ext_csv6
tail(ext_csv4)
tail(ext_csv4,11)
ext_csv7 <- ext_csv4[, -(2348:2358)]
tail(ext_csv7)
ext_csv7 <- ext_csv4[-(2348:2358), ]
tail(ext_csv7)
dim(ext_csv4)
ext_csv7 <- ext_csv4[-(2343:2353), ]
dim(ext_csv4)
dim(ext_csv7)
tail(ext_csv7)
ext_csv8 <- merge(ext_csv6, ext_csv7, by = "gdenr" )
head(ext_csv8)
ext_csv8 <- merge(ext_csv6, ext_csv7, by = gdenr )
ext_csv8 <- merge(ext_csv6, ext_csv7, by = "gdenr" )
head(ext_csv)
ext_csv8
ext_csv6
ext_csv6$gdenr <- ext_csv6$gdenr_without_polling_station
ext_csv6$gdename <- ext_csv6$gdename_without_polling_station
ext_cvs6 <- c("gdenr", "gdename")
ext_csv6
keep <- c("gdenr", "gdename")
ext_csv6  <- ext_cvs6[keep]
head(ext_csv6)
keep <- c("ext_csv6$gdenr", "ext_csv6$gdename")
ext_csv6  <- ext_cvs6[keep]
head(ext_csv6)
keep <- c(ext_csv6$gdenr, ext_csv6$gdename)
ext_csv6 <- ext_csv5
ext_csv6$gdenr <- ext_csv6$gdenr_without_polling_station
ext_csv6$gdename <- ext_csv6$gdename_without_polling_station
head(ext_csv6)
keep <- c("gdenr", "gdename")
ext_csv6 <- ext_csv6[keep]
ext_csv6
ext_csv6$entitled_to_vote" <- NA
ext_csv6$votes_cast <- NA
ext_csv6$turnout <- NA
ext_csv6$valid_votes <- NA
ext_csv6$yes  <- NA
ext_csv6$no <- NA
ext_csv6$yes_percentage <- NA
keep <- c("gdenr", "gdename")
ext_csv6 <- ext_csv6[keep]
ext_csv6$entitled_to_vote <- NA
ext_csv6$votes_cast <- NA
ext_csv6$turnout <- NA
ext_csv6$valid_votes <- NA
ext_csv6$yes  <- NA
ext_csv6$no <- NA
ext_csv6$yes_percentage <- NA
ext_csv6 <- ext_csv5
ext_csv6$gdenr <- ext_csv6$gdenr_without_polling_station
ext_csv6$gdename <- ext_csv6$gdename_without_polling_station
keep <- c("gdenr", "gdename")
ext_csv6 <- ext_csv6[keep]
ext_csv6$entitled_to_vote <- NA
ext_csv6$votes_cast <- NA
ext_csv6$turnout <- NA
ext_csv6$valid_votes <- NA
ext_csv6$yes  <- NA
ext_csv6$no <- NA
ext_csv6$yes_percentage <- NA
ext_csv6
ext_csv8 <- rbind(ext_csv6, ext_csv7, by = "gdenr" )
ext_csv8
head(ext_csv8)
head(ext_csv8, 15)
ext_csv8 <- rbind(ext_csv7, ext_csv6, by = "gdenr" )
head(ext_csv8)
tail(ext_csv8)
dim(ext_csv8)
ext_csv6 <- ext_csv5
ext_csv6$gdenr <- ext_csv6$gdenr_without_polling_station
ext_csv6$gdename <- ext_csv6$gdename_without_polling_station
## Reduce to gdenr, gdename
keep <- c("gdenr", "gdename")
ext_csv6 <- ext_csv6[keep]
ext_csv6$entitled_to_vote <- NA
ext_csv6$votes_cast <- NA
ext_csv6$turnout <- NA
ext_csv6$valid_votes <- NA
ext_csv6$yes  <- NA
ext_csv6$no <- NA
ext_csv6$yes_percentage <- NA
## Delete Swiss Abroad
tail(ext_csv4,11)
ext_csv7 <- ext_csv4[-(2343:2353), ]
## tail(ext_csv7)
## Add non polling station municipalities
ext_csv8 <- rbind(ext_csv7, ext_csv6, by = "gdenr")
dim(ext_csv8)
tail(ext_csv8, 1)
ext_csv8 <- rbind(ext_csv7, ext_csv6)
tail(ext_csv8)
dim(ext_csv8)
ext_csv9 <- ext_csv8[order(gdenr),]
ext_csv9 <- ext_csv8[order(ext_csv8$gdenr),]
tail(ext_csv9)
ext_csv9 <- ext_csv8[order(gdenr), ]
head(ext_csv8)
head(ext_csv9)
ext_csv9 <- ext_csv8[order(as.numeric(ext_csv8$gdenr)), ]
head(ext_csv9)
head(ext_csv9, 50)
tail(ext_csv9, 50)
write.table(ext_csv9, file="ext_initiative_20140902.csv", sep="," , col.names=TRUE, row.names=FALSE)
glg14 <- read.csv("g1g14.csv", header = TRUE, sep = ",", stringsAsFactors=FALSE)
head(glg14)
head(ext)
glg14$gdenr <- glg14$GMDNR
head(glg14)
require(dplyr)
anti_join(table1, table2, by="gdenr")
anti_join(ext_csv9, glg14, by="gdenr")
glg14$gdenr <- as.character(glg14$GMDNR)
anti_join(ext_csv9, glg14, by="gdenr")
dim(ext_csv9)
dim(glg14)
glg14nr <- glg14$gdenr
ext_csv9nr <- ext_csv9$gdenr
anti_join(ext_csv9nr, glg14nr, by="gdenr")
glg14$gdenr <- as.numeric(glg14$GMDNR)
ext_csv9$gdenr <- as.numeric(ext_csv9$gdenr)
anti_join(ext_csv9, glg14, by="gdenr")
glg14nr <- glg14$gdenr
ext_csv9nr <- ext_csv9$gdenr
anti_join(ext_csv9nr, glg14nr, by="gdenr")
dim(ext_csv9nr)
glg14nr
ext_csv9nr
anti_join(ext_csv9nr, glg14nr, by="gdenr")
glg14$gdenr <- as.character(glg14$GMDNR)
ext_csv9$gdenr <- as.character(ext_csv9$gdenr)
anti_join(ext_csv9, glg14, by="gdenr")
head(ext_csv9)
head(glg14)
names(glg14) <- as.character(c("gdenr", "gdename"))
head(glg14)
anti_join(ext_csv9, glg14, by="gdenr")
names(glg14) <- c("gdenr", "gdename")
class(glg14$gdenr)
class(glg14$gdename)
ext_csv9$gdenr <- as.numeric(ext_csv9$gdenr)
anti_join(ext_csv9, glg14, by="gdenr")
class(ext_csv9$gdenr)
anti_join(ext_csv9, glg14, by=c("gdenr", "gdename"))
glg14_s <- select(glg14, GMDNR, GMDNAME)
glg14 <- read.csv("g1g14.csv", header = TRUE, sep = ",", stringsAsFactors=FALSE)
glg14_s <- select(glg14, GMDNR, GMDNAME)
head(glg14_s)
names(glg14_s) <- c("gdenr", "gdename")
head(glg14_s)
ext_csv9_s <- select(ext_csv9, gdenr, gdename)
head(ext_csv9_s)
ext_csv9_s$gdenr <- as.numeric(ext_csv9_s$gdenr)
anti_join(ext_csv9_s, glg14_s, by="gdenr")
glg14_u <- unique(glg14)
tail(ext_csv9_s)
tail(glg14_s)
glg14_s2 <- na.omit(glg14_s)
dim(ext_csv9_s)
dim(glg14_s)
class(glg14_s)
class(glg14_s$gdenr)
class(ext_csv9_s$gdenr)
ext_csv9_s$gdenr <- as.integer(ext_csv9_s$gdenr)
class(ext_csv9_s$gdenr)
anti_join(ext_csv9_s, glg14_s, by="gdenr")
anti_join(ext_csv9_s, glg14_s, by="gdenr")
anti_join(ext_csv9_s, glg14_s, by="gdename")
anti_join(ext_csv9_s, glg14_s, by="gdenr")
anti_join(ext_csv9_s, glg14_s)
anti_join(ext_csv9_s, glg14_s, by="gdenr")
duplicated(glg14_s)
anti_join(ext_csv9_s, glg14_s, by="gdename")
ext_csv9 <- ext_csv9_s[order(gdenr), ]
glg14_s <- glg14_s[order(gdenr), ]
ext_csv9 <- ext_csv9_s[order("gdenr"), ]
head(ext_csv9, 50)
head(ext_csv9_s, 50)
glg14_s <- glg14_s[order("gdenr"), ]
glg14_s <- glg14_s[order("gdenr"), ]
diff <- merge(ext_csv9_s, glg14_s, by="gdenr")
diff
ext_csv9
ext_csv9_s <- ext_csv9_s[order("gdenr"), ]
glg14_s <- glg14_s[order("gdenr"), ]
head(glg14_s)
dim(ext_csv9_s)
dim(glg14_s)
glg14_s <- select(glg14, GMDNR, GMDNAME)
names(glg14_s) <- c("gdenr", "gdename")
ext_csv9_s <- select(ext_csv9, gdenr, gdename)
ext_csv9_s$gdenr <- as.integer(ext_csv9_s$gdenr)
head(ext_csv9_s)
ext_csv9 <- ext_csv8[order(as.numeric(ext_csv8$gdenr)), ]
anti_join(ext_csv9_s, glg14_s, by="gdenr")
glg14_s <- glg14_s[order("gdenr"), ]
diff <- merge(ext_csv9_s, glg14_s, by="gdenr")
head(diff)
ext_csv9_s <- select(ext_csv9, gdenr, gdename)
glg14_s <- select(glg14, GMDNR, GMDNAME)
names(glg14_s) <- c("gdenr", "gdename")
dim(ext_csv9_s)
dim(glg14_s)
ajoin <- anti_join(ext_csv9_s, glg14_s, by="gdename")
ajoinnr <- anti_join(ext_csv9_s, glg14_s, by="gdenr")
ext_csv9_s$gdenr <- as.integer(ext_csv9_s$gdenr)
ajoinnr <- anti_join(ext_csv9_s, glg14_s, by="gdenr")
diff <- merge(ext_csv9_s, glg14_s, by="gdenr")
head(diff)
install.packages("daff")
install.packages("daff")
library(daff)
diff_data(ext_csv9_s, glg14_s)
